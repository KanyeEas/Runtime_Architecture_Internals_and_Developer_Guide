
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Ark runtime_core/static_core internal wiki（概览 + 深入证据链）">
      
      
      
        <link rel="canonical" href="https://github.com/KanyeEas/Runtime_Architecture_Internals_and_Developer_Guide/04_ExecutionEngine/FileNotes/irtoc_scripts_interpreter.irt/">
      
      
        <link rel="prev" href="../irtoc_scripts_common.irt/">
      
      
        <link rel="next" href="../isa_isa.yaml/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>irtoc_scripts_interpreter.irt - Runtime Architecture Internals & Developer Guide</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#irtocscriptsinterpreterirtirtocllvm-fast-interpreter" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Runtime Architecture Internals &amp; Developer Guide" class="md-header__button md-logo" aria-label="Runtime Architecture Internals & Developer Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Runtime Architecture Internals & Developer Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              irtoc_scripts_interpreter.irt
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换到夜间模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换到夜间模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换到日间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换到日间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  
    
  
  00 总览与方法论

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../01_Startup/" class="md-tabs__link">
          
  
  
    
  
  01 Startup

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../02_Memory/" class="md-tabs__link">
          
  
  
    
  
  02 Memory

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../03_ClassLoading/" class="md-tabs__link">
          
  
  
    
  
  03 ClassLoading

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  04 ExecutionEngine

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../05_NativeBridge/" class="md-tabs__link">
          
  
  
    
  
  05 NativeBridge

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../06_Tooling_Profiling_Verification/" class="md-tabs__link">
          
  
  
    
  
  06 Tooling

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../07_Build_and_Configuration/" class="md-tabs__link">
          
  
  
    
  
  07 Build&Config

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Runtime Architecture Internals &amp; Developer Guide" class="md-nav__button md-logo" aria-label="Runtime Architecture Internals & Developer Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Runtime Architecture Internals & Developer Guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../.." class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    00 总览与方法论
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../01_Startup/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    01 Startup
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../02_Memory/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    02 Memory
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../03_ClassLoading/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    03 ClassLoading
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    04 ExecutionEngine
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    04 ExecutionEngine
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Flows/ExecutionEngine_EndToEnd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    端到端主线（EndToEnd）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Newbie_MinDebug_Playbook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    新人最小调试手册
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    深入路线图（Index）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Completion_Review/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    完成度验收（Checklist）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Errata_to_Stage1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stage1 校正（Errata）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" checked>
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    专题索引
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    专题索引
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../Flows/Index/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Flows
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../DataStructures/Index/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    DataStructures
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../Diagrams/Index/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Diagrams
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../Manifests/Index/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Manifests
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5_7_5" id="__nav_5_7_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    FileNotes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_7_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_7_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    FileNotes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Index
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../_Glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    _Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_irtoc_irtoc_interpreter_disasm.txt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    build_irtoc_irtoc_interpreter_disasm.txt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_irtoc_irtoc_interpreter_interpreter.irt.fixed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    build_irtoc_irtoc_interpreter_interpreter.irt.fixed
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_irtoc_irtoc_interpreter_irtoc_code.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    build_irtoc_irtoc_interpreter_irtoc_code.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_irtoc_irtoc_interpreter_validation.yaml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    build_irtoc_irtoc_interpreter_validation.yaml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_runtime_include_irtoc_interpreter_utils.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    build_runtime_include_irtoc_interpreter_utils.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bytecode_optimizer_optimize_bytecode.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    bytecode_optimizer_optimize_bytecode.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bytecode_optimizer_optimize_bytecode.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    bytecode_optimizer_optimize_bytecode.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compiler_aot_aot_file.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    compiler_aot_aot_file.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compiler_aot_aot_file.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    compiler_aot_aot_file.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compiler_aot_aot_headers.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    compiler_aot_aot_headers.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compiler_aot_aot_manager.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    compiler_aot_aot_manager.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compiler_aot_aot_manager.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    compiler_aot_aot_manager.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compiler_aot_compiled_method.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    compiler_aot_compiled_method.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../irtoc_scripts_common.irt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    irtoc_scripts_common.irt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    irtoc_scripts_interpreter.irt
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    irtoc_scripts_interpreter.irt
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-l18l40" class="md-nav__link">
    <span class="md-ellipsis">
      
        0. 固定寄存器与校验（L18–L40）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-decode-dispatchcomputed-goto-irtoc-l156l413" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. decode + dispatch：computed-goto 的 IRTOC 版本（L156–L413）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. decode + dispatch：computed-goto 的 IRTOC 版本（L156–L413）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-decode" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 decode
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 dispatch 宏（最关键）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-framevregacc-c-l248l389" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Frame/VReg/Acc：与 C++ 语义一致，但更“显式”（L248–L389）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Frame/VReg/Acc：与 C++ 语义一致，但更“显式”（L248–L389）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-bytecode-offsetdeopt" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 bytecode offset（deopt/异常/调试依赖）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-vreg-mirrortag" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 vreg 地址计算（静态语言 mirror/tag）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-acc" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 acc 的“写回/恢复”是不变量
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-find_catch_block-move_to_exceptionl509l536" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. 异常处理：find_catch_block + move_to_exception（L509–L536）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 异常处理：find_catch_block + move_to_exception（L509–L536）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-stackless-iframes-catchruntime" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 stackless IFrames 找 catch（runtime 侧）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-dispatch_table-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 进入异常入口（dispatch_table 的“末尾 handler”）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-safepoint-osr-fake-returnl559l644-l2152l2185" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. safepoint + OSR：回边插桩 + fake-return（L559–L644, L2152–L2185）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. safepoint + OSR：回边插桩 + fake-return（L559–L644, L2152–L2185）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-safepoint-flag" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 safepoint（线程 flag 驱动）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-osr" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 回边插桩：OSR 触发点就在分支里
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-fake-return-return-osr" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 fake-return：让解释器循环“像 return 一样退出”去进入 OSR
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-generic_callgeneric_returnl780l877" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. 调用/返回：generic_call/generic_return（L780–L877）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. 调用/返回：generic_call/generic_return（L780–L877）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-generic_call" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 generic_call：两条路
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-generic_returnstackless-or-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 generic_return：stackless 弹栈 or 退出到 runtime
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-method-resolutionget_calleel2000l2031" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. method resolution：get_callee（L2000–L2031）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-handler-pandainstructionseachl2407" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. handler 生成：Panda.instructions.each（L2407–...）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    <span class="md-ellipsis">
      
        证据链（build/ 对照）
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../isa_isa.yaml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    isa_isa.yaml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugins_ets_isa_isa.yaml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    plugins_ets_isa_isa.yaml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickener_quick.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    quickener_quick.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_arch_aarch64_osr_aarch64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_arch_aarch64_osr_aarch64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_arch_amd64_osr_amd64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_arch_amd64_osr_amd64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_arch_arm_osr_arm.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_arch_arm_osr_arm.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_arch_asm_support.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_arch_asm_support.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_arch_x86_osr_x86.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_arch_x86_osr_x86.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_arch_aarch64_compiled_code_to_interpreter_bridge_aarch64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_arch_aarch64_compiled_code_to_interpreter_bridge_aarch64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_arch_aarch64_compiled_code_to_interpreter_bridge_dyn_aarch64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_arch_aarch64_compiled_code_to_interpreter_bridge_dyn_aarch64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_arch_aarch64_deoptimization_aarch64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_arch_aarch64_deoptimization_aarch64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_arch_aarch64_interpreter_to_compiled_code_bridge_aarch64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_arch_aarch64_interpreter_to_compiled_code_bridge_aarch64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_arch_aarch64_interpreter_to_compiled_code_bridge_dyn_aarch64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_arch_aarch64_interpreter_to_compiled_code_bridge_dyn_aarch64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_arch_aarch64_proxy_entrypoint_aarch64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_arch_aarch64_proxy_entrypoint_aarch64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_arch_amd64_compiled_code_to_interpreter_bridge_amd64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_arch_amd64_compiled_code_to_interpreter_bridge_amd64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_arch_amd64_compiled_code_to_interpreter_bridge_dyn_amd64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_arch_amd64_compiled_code_to_interpreter_bridge_dyn_amd64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_arch_amd64_deoptimization_amd64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_arch_amd64_deoptimization_amd64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_arch_amd64_interpreter_to_compiled_code_bridge_amd64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_arch_amd64_interpreter_to_compiled_code_bridge_amd64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_arch_amd64_interpreter_to_compiled_code_bridge_dyn_amd64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_arch_amd64_interpreter_to_compiled_code_bridge_dyn_amd64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_arch_amd64_proxy_entrypoint_amd64.S/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_arch_amd64_proxy_entrypoint_amd64.S
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_bridge.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_bridge.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_bridge_bridge.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_bridge_bridge.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_compiler.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_compiler.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_compiler.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_compiler.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_deoptimization.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_deoptimization.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_deoptimization.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_deoptimization.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_entrypoints_entrypoints.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_entrypoints_entrypoints.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_entrypoints_entrypoints.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_entrypoints_entrypoints.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_exceptions.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_exceptions.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_include_compiler_interface.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_include_compiler_interface.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_include_exceptions.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_include_exceptions.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_include_stack_walker.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_include_stack_walker.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_acc_vregister-inl.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_acc_vregister-inl.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_acc_vregister.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_acc_vregister.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_arch_macros.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_arch_macros.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_frame.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_frame.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_instruction_handler_base.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_instruction_handler_base.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_instruction_handler_state.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_instruction_handler_state.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_interpreter-inl.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_interpreter-inl.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_interpreter.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_interpreter.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_interpreter.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_interpreter.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_interpreter_impl.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_interpreter_impl.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_interpreter_impl.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_interpreter_impl.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_runtime_interface.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_runtime_interface.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_state.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_state.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_templates_interpreter-inl_gen.h.erb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_templates_interpreter-inl_gen.h.erb
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_templates_irtoc_interpreter_utils.h.erb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_templates_irtoc_interpreter_utils.h.erb
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_templates_isa_constants_gen.h.erb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_templates_isa_constants_gen.h.erb
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_interpreter_vregister.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_interpreter_vregister.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_osr.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_osr.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_osr.h/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_osr.h
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_stack_walker.cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_stack_walker.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_templates_bridge_dispatch.S.erb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_templates_bridge_dispatch.S.erb
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_templates_bridge_dispatch_dyn.S.erb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_templates_bridge_dispatch_dyn.S.erb
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_templates_plugins_interpreters-inl.h.erb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    runtime_templates_plugins_interpreters-inl.h.erb
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../05_NativeBridge/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    05 NativeBridge
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../06_Tooling_Profiling_Verification/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    06 Tooling
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../07_Build_and_Configuration/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    07 Build&Config
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-l18l40" class="md-nav__link">
    <span class="md-ellipsis">
      
        0. 固定寄存器与校验（L18–L40）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-decode-dispatchcomputed-goto-irtoc-l156l413" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. decode + dispatch：computed-goto 的 IRTOC 版本（L156–L413）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. decode + dispatch：computed-goto 的 IRTOC 版本（L156–L413）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-decode" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 decode
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 dispatch 宏（最关键）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-framevregacc-c-l248l389" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Frame/VReg/Acc：与 C++ 语义一致，但更“显式”（L248–L389）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Frame/VReg/Acc：与 C++ 语义一致，但更“显式”（L248–L389）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-bytecode-offsetdeopt" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 bytecode offset（deopt/异常/调试依赖）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-vreg-mirrortag" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 vreg 地址计算（静态语言 mirror/tag）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-acc" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 acc 的“写回/恢复”是不变量
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-find_catch_block-move_to_exceptionl509l536" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. 异常处理：find_catch_block + move_to_exception（L509–L536）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 异常处理：find_catch_block + move_to_exception（L509–L536）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-stackless-iframes-catchruntime" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 stackless IFrames 找 catch（runtime 侧）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-dispatch_table-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 进入异常入口（dispatch_table 的“末尾 handler”）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-safepoint-osr-fake-returnl559l644-l2152l2185" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. safepoint + OSR：回边插桩 + fake-return（L559–L644, L2152–L2185）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. safepoint + OSR：回边插桩 + fake-return（L559–L644, L2152–L2185）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-safepoint-flag" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 safepoint（线程 flag 驱动）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-osr" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 回边插桩：OSR 触发点就在分支里
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-fake-return-return-osr" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 fake-return：让解释器循环“像 return 一样退出”去进入 OSR
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-generic_callgeneric_returnl780l877" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. 调用/返回：generic_call/generic_return（L780–L877）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. 调用/返回：generic_call/generic_return（L780–L877）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-generic_call" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 generic_call：两条路
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-generic_returnstackless-or-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 generic_return：stackless 弹栈 or 退出到 runtime
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-method-resolutionget_calleel2000l2031" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. method resolution：get_callee（L2000–L2031）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-handler-pandainstructionseachl2407" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. handler 生成：Panda.instructions.each（L2407–...）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    <span class="md-ellipsis">
      
        证据链（build/ 对照）
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="irtocscriptsinterpreterirtirtocllvm-fast-interpreter"><code>irtoc/scripts/interpreter.irt</code>（逐行精读｜IRTOC/LLVM Fast Interpreter 的“真实解释器语义”）<a class="headerlink" href="#irtocscriptsinterpreterirtirtocllvm-fast-interpreter" title="Permanent link">&para;</a></h1>
<blockquote>
<p>章节归属：Stage2 / 04_ExecutionEngine（Execution Engine）<br />
文件规模：约 3.3k 行（Ruby DSL，生成 IRTOC graph / handler）<br />
本文件角色：定义 fast interpreter 的完整语义：
- <strong>内部 calling convention</strong>：固定寄存器保存 <code>tr/pc/frame/acc/dispatch</code>（不同 arch 不同）
- <strong>dispatch</strong>：computed-goto 风格（<code>tail_call(addr)</code>）到 <code>HANDLE_FAST_*</code>
- <strong>异常/OSR/stackless call-return</strong>：全部在脚本里以宏的形式编码
- <strong>为每个 bytecode opcode 生成一个 <code>HANDLE_FAST_&lt;handler_name&gt;</code> 函数</strong></p>
<p>强依赖：
- <code>include_relative 'common.irt'</code>：regmap/Constants（Frame/Thread/Method 的 offset 与 tag）
- build 产物证据：<code>build/irtoc/irtoc_interpreter/interpreter.irt.fixed</code>（规范化脚本）、<code>irtoc_code.cpp</code>（Graph 构造）</p>
</blockquote>
<hr />
<h2 id="0-l18l40">0. 固定寄存器与校验（L18–L40）<a class="headerlink" href="#0-l18l40" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>L18–L23</strong>：<code>fixed_regmap</code>：为 fast interpreter 选择“永驻寄存器”：</li>
<li>x86_64：<code>dispatch/pc/frame/acc/acc_tag</code></li>
<li>arm64：额外有 <code>moffset/method_ptr</code>（避免频繁从 frame 计算 mirror 偏移/方法指针）</li>
<li><strong>L23</strong>：<code>handler_regmap = $full_regmap + fixed_regmap</code>：handler 使用“全寄存器 + 固定寄存器”。</li>
<li><strong>L25–L36</strong>：sanity checks（arm64 才做）：确保 fixed regs 不与 panda/arch/args/caller regs 冲突。</li>
<li><strong>L38–L40</strong>：<code>InterpreterValidation.spills_count_max=32</code>：与后续 <code>validation.yaml</code> 对齐，限制 spills 数。</li>
</ul>
<blockquote>
<p>结论：fast interpreter 的核心是“把解释器状态（pc/frame/acc）放到固定寄存器”，减少内存访存。</p>
</blockquote>
<hr />
<h2 id="1-decode-dispatchcomputed-goto-irtoc-l156l413">1. decode + dispatch：computed-goto 的 IRTOC 版本（L156–L413）<a class="headerlink" href="#1-decode-dispatchcomputed-goto-irtoc-l156l413" title="Permanent link">&para;</a></h2>
<h3 id="11-decode">1.1 decode<a class="headerlink" href="#11-decode" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>L158–L206</strong>：<code>readbyte/as_vreg_idx/as_id</code> 等宏：按 operand width 从 <code>pc</code> 读取立即数/vreg index。</li>
<li><code>as_vreg_idx</code> 直接把“编码在指令流里的寄存器编号”转为 vreg index（用于 frame slot address 计算）。</li>
</ul>
<h3 id="12-dispatch">1.2 dispatch 宏（最关键）<a class="headerlink" href="#12-dispatch" title="Permanent link">&para;</a></h3>
<p>核心在 <strong><code>macro(:dispatch)</code></strong>（L406–L413）：</p>
<ul>
<li><strong>L407</strong>：<code>opc := readbyte(pc, 0)</code>：取 opcode</li>
<li><strong>L408</strong>：<code>offset := Mul(u8toword(opc), WordSize())</code>：计算 <code>dispatch_table[opc]</code> 的地址偏移</li>
<li><strong>L409</strong>：<code>addr := Load(table, offset)</code>：读出 handler 函数指针</li>
<li><strong>L410–L412</strong>：把 <code>pc/table</code> LiveOut 到固定寄存器</li>
<li><strong>L412</strong>：<code>tail_call(addr)</code>：<strong>以 TAIL_CALL intrinsic 进入 handler</strong></li>
</ul>
<blockquote>
<p>这就是 computed-goto 的等价形式：不是 <code>switch</code>，也不是函数返回再循环，而是“尾调用跳转到下一 handler”。</p>
</blockquote>
<hr />
<h2 id="2-framevregacc-c-l248l389">2. Frame/VReg/Acc：与 C++ 语义一致，但更“显式”（L248–L389）<a class="headerlink" href="#2-framevregacc-c-l248l389" title="Permanent link">&para;</a></h2>
<h3 id="21-bytecode-offsetdeopt">2.1 bytecode offset（deopt/异常/调试依赖）<a class="headerlink" href="#21-bytecode-offsetdeopt" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>L248–L255</strong>：<code>ins_offset</code>/<code>update_bytecode_offset</code>：通过 <code>pc - frame-&gt;instructions</code> 计算并写回 <code>frame-&gt;bcOffset</code>。</li>
</ul>
<h3 id="22-vreg-mirrortag">2.2 vreg 地址计算（静态语言 mirror/tag）<a class="headerlink" href="#22-vreg-mirrortag" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>L259–L267</strong>：<code>frame_vreg_ptr</code>/<code>vreg_ptr</code>：<code>frame + VREGISTERS_OFFSET + vreg_idx * VREGISTER_SIZE</code></li>
<li><strong>L294–L306</strong>：<code>get_tag/set_tag</code>：tag 存在 mirror 区（<code>vreg_ptr + moffset</code>）</li>
<li><strong>L312–L320</strong>：<code>set_primitive/set_object</code>：把 tag 与 payload 同步写入</li>
</ul>
<h3 id="23-acc">2.3 acc 的“写回/恢复”是不变量<a class="headerlink" href="#23-acc" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>L331–L358</strong>：<code>save_acc/save_acc_var</code>：把 <code>%acc/%acc_tag</code> 写回到 frame 的 acc slot（value + mirror）</li>
<li><strong>L360–L366</strong>：<code>restore_acc/restore_acc_tag</code>：从 frame 读回</li>
<li><strong>L373–L379</strong>：<code>set_acc_primitive/set_acc_object</code>：acc 的 tag 语义（primitive vs object）</li>
</ul>
<blockquote>
<p>这直接解释了 fast interpreter 中频繁出现的 “call runtime 前 save_acc，回来再 restore_acc”：为了让 GC/stackwalker/hook 能看到一致状态。</p>
</blockquote>
<hr />
<h2 id="3-find_catch_block-move_to_exceptionl509l536">3. 异常处理：<code>find_catch_block</code> + <code>move_to_exception</code>（L509–L536）<a class="headerlink" href="#3-find_catch_block-move_to_exceptionl509l536" title="Permanent link">&para;</a></h2>
<h3 id="31-stackless-iframes-catchruntime">3.1 stackless IFrames 找 catch（runtime 侧）<a class="headerlink" href="#31-stackless-iframes-catchruntime" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>L509–L523</strong>：<code>find_catch_block</code>：</li>
<li>调 <code>FindCatchBlockInIFrames(tr, frame, pc)</code> 返回 handler_pc</li>
<li>若返回 <code>pc</code>（未找到）：<code>Intrinsic(:INTERPRETER_RETURN)</code> 退出到上层（由 runtime 继续处理 CFrames）</li>
<li>否则读出 EH frame（<code>THREAD_FRAME_OFFSET</code>）与其 acc，返回 handler_pc</li>
</ul>
<blockquote>
<p>这就是我们在 C++ 解释器中总结的“两段式异常”：先 stackless IFrames，找不到再交给 call-stack/CFrames（见 <code>runtime/exceptions.cpp</code>）。</p>
</blockquote>
<h3 id="32-dispatch_table-handler">3.2 进入异常入口（dispatch_table 的“末尾 handler”）<a class="headerlink" href="#32-dispatch_table-handler" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>L525–L536</strong>：<code>move_to_exception</code>：</li>
<li>把 table/frame/(moffset/method_ptr)/tr/pc 全部 LiveOut</li>
<li><strong>L534</strong>：<code>addr := Load(table, Panda::dispatch_table.handler_names.size * 8)</code>：取 dispatch_table 的最后一个 slot</li>
<li><code>tail_call(addr)</code>：跳到 <strong><code>HANDLE_FAST_EXCEPTION</code></strong></li>
</ul>
<blockquote>
<p>这与 build 产物 <code>irtoc_interpreter_utils.h</code> 完全对齐：dispatch_table[391]（最后一个）是 <code>HANDLE_FAST_EXCEPTION</code>（或 <code>_LLVM</code> 版本）。</p>
</blockquote>
<hr />
<h2 id="4-safepoint-osr-fake-returnl559l644-l2152l2185">4. safepoint + OSR：回边插桩 + fake-return（L559–L644, L2152–L2185）<a class="headerlink" href="#4-safepoint-osr-fake-returnl559l644-l2152l2185" title="Permanent link">&para;</a></h2>
<h3 id="41-safepoint-flag">4.1 safepoint（线程 flag 驱动）<a class="headerlink" href="#41-safepoint-flag" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>L560–L571</strong>：<code>safepoint(acc_type, is_save_acc)</code>：</li>
<li>如果 thread flag 非 0，则可选 <code>save_acc_var</code>，调用 <code>SafepointEntrypointInterp(tr)</code>，并恢复 acc</li>
</ul>
<h3 id="42-osr">4.2 回边插桩：OSR 触发点就在分支里<a class="headerlink" href="#42-osr" title="Permanent link">&para;</a></h3>
<p>典型出现在 <code>handle_jmp_*</code> 系列：</p>
<ul>
<li><strong>L610–L644</strong>：<code>instrument_branches(imm, acc_type, method_ptr)</code>：</li>
<li><code>imm &lt;= 0</code> 表示回边：先做 safepoint</li>
<li>hotness&lt;=0：调用 <code>CallCompilerSlowPathOSR(...)</code></li>
<li>若 OSR 成功：<strong>L620</strong> 调 <code>handle_fake_return()</code>（强制从当前 frame 退出到 caller）</li>
<li>通过一组 Phi 把 <code>acc/frame/pc</code> 更新为 “正常继续执行”或“fake-return 后的状态”</li>
</ul>
<h3 id="43-fake-return-return-osr">4.3 fake-return：让解释器循环“像 return 一样退出”去进入 OSR<a class="headerlink" href="#43-fake-return-return-osr" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>L2152–L2185</strong>：<code>handle_fake_return</code>：</li>
<li>若当前不是 stackless：直接 <code>Intrinsic(:INTERPRETER_RETURN)</code>（退出到 runtime）</li>
<li>否则：<ul>
<li>取 <code>fake_frame = prev_frame</code>，<code>fake_pc = prev_frame-&gt;nextInst</code></li>
<li>若 <code>IS_INITOBJ</code>：acc 从 prev_frame 的 acc 取 object；否则从当前 frame restore_acc</li>
<li><code>THREAD_FRAME_OFFSET = fake_frame</code>，并 <code>FreeFrameInterp(cur_frame, tr)</code></li>
<li>若存在 pending exception：把 pc 设置到 fake_frame 上并 <code>move_to_exception</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>这段是 OSR 的关键难点：OSR 成功后并不是“直接跳到 OSR code”，而是让解释器通过“伪造 return 弹栈”回到某个稳定边界，再由上层进入 OSR。</p>
</blockquote>
<hr />
<h2 id="5-generic_callgeneric_returnl780l877">5. 调用/返回：<code>generic_call</code>/<code>generic_return</code>（L780–L877）<a class="headerlink" href="#5-generic_callgeneric_returnl780l877" title="Permanent link">&para;</a></h2>
<h3 id="51-generic_call">5.1 <code>generic_call</code>：两条路<a class="headerlink" href="#51-generic_call" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>L780–L840</strong>：<code>generic_call(id, size, is_initobj, callee, nargs, copy_lambda)</code>：
  1) <strong>callee 已编译</strong>（L787–L801）<ul>
<li>读 <code>callee-&gt;compiled_entrypoint</code></li>
<li><code>IsCompiled(entrypoint)</code> 为真：
   -（非 initobj）保存 acc</li>
<li>调 <code>InterpreterToCompiledCodeBridge(pc, frame, callee, tr)</code>（I2C）</li>
<li>恢复 <code>Thread</code> 的 <code>FrameKind</code> 与 <code>THREAD_FRAME_OFFSET</code></li>
<li>检查 exception；从 frame restore acc；pc 前进
  2) <strong>callee 未编译</strong>（L803–L839）</li>
<li>取 <code>pc_int = get_instructions(callee)</code>，<code>num_vregs = get_numvregs(callee)</code></li>
<li>分配新 frame：<code>create_frame(frame_size, callee)</code> 并标记 <code>Frame::IS_STACKLESS</code></li>
<li><code>copy_lambda</code> 负责把实参拷贝到新 frame 的 vregs（含 acc 参与的 call_acc 变体）</li>
<li>设置 <code>prev_frame/next_instruction/instructions</code>，并把 <code>THREAD_FRAME_OFFSET</code> 指向新 frame</li>
</ul>
</li>
</ul>
<blockquote>
<p>这解释了为什么 fast interpreter 同样依赖 “stackless frame 弹栈”：未编译调用会走解释器栈帧链；已编译调用则走 I2C。</p>
</blockquote>
<h3 id="52-generic_returnstackless-or-runtime">5.2 <code>generic_return</code>：stackless 弹栈 or 退出到 runtime<a class="headerlink" href="#52-generic_returnstackless-or-runtime" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>L859–L877</strong>：</li>
<li>若 <code>IS_STACKLESS</code>：取 prev_frame/next_pc，copy 返回值到 prev_frame，更新 <code>THREAD_FRAME_OFFSET</code>，free_frame，回到 caller 继续执行</li>
<li>否则：<code>save_acc(); Intrinsic(:INTERPRETER_RETURN)</code>（返回到 runtime 边界）</li>
</ul>
<hr />
<h2 id="6-method-resolutionget_calleel2000l2031">6. method resolution：<code>get_callee</code>（L2000–L2031）<a class="headerlink" href="#6-method-resolutionget_calleel2000l2031" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>L2001</strong>：<code>update_bytecode_offset</code>：确保 frame-&gt;bcOffset 与 pc 对齐（deopt/异常/调试依赖）</li>
<li><strong>L2003–L2010</strong>：</li>
<li>initobj：走 cache_entry，但不走 slowpath（nil）</li>
<li>非 initobj：<code>callee_ptr(id, need_save=true)</code>，需要时 restore acc；callee 为空则 <code>move_to_exception</code></li>
<li><strong>L2012–L2027</strong>（非 initobj 的 receiver/虚调用）：</li>
<li>若非 static：读取 receiver（可能来自 acc 或 vreg，取决于 imm）</li>
<li>receiver 为 null：抛 NPE 并 <code>move_to_exception</code></li>
<li>virt call：<code>ResolveVirtualMethod(callee, frame, receiver_ref, pc, method_ptr)</code></li>
</ul>
<hr />
<h2 id="7-handler-pandainstructionseachl2407">7. handler 生成：<code>Panda.instructions.each</code>（L2407–...）<a class="headerlink" href="#7-handler-pandainstructionseachl2407" title="Permanent link">&para;</a></h2>
<p>脚本末尾会遍历 ISA 描述，为每个 opcode 生成 <code>HANDLE_FAST_&lt;handler_name&gt;</code>：</p>
<ul>
<li>通过 <code>handler_name = i.handler_name.gsub(/_PROF\\d+/, '')</code> 去掉 profile suffix</li>
<li>构造函数时会：
  -（dynamic 指令）先 <code>save_acc</code>（源码注释标注为 <em>planned removal</em>：这不是本章遗漏，而是上游实现的已知演进点）</li>
<li>debug 模式下做 tag/assert 校验（大量 <code>assert_has_object_eq/ne</code>）</li>
<li><code>case handler_name</code> 里调用对应的 <code>handle_xxx</code> 宏（例如 mov/lda/call/branch 等）</li>
</ul>
<blockquote>
<p>这就是为什么 <code>build/runtime/include/irtoc_interpreter_utils.h</code> 能枚举出 392 个 <code>HANDLE_FAST_*</code>：它们由这里自动生成。</p>
</blockquote>
<hr />
<h2 id="build">证据链（build/ 对照）<a class="headerlink" href="#build" title="Permanent link">&para;</a></h2>
<ul>
<li>dispatch table（392 项 + EXCEPTION slot）：<code>build/runtime/include/irtoc_interpreter_utils.h</code></li>
<li>规范化脚本：<code>build/irtoc/irtoc_interpreter/interpreter.irt.fixed</code></li>
<li>生成的 Graph 构造：<code>build/irtoc/irtoc_interpreter/irtoc_code.cpp</code></li>
<li>runtime 入口调用：<code>runtime/interpreter/interpreter_impl.cpp</code></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.prune", "navigation.indexes", "navigation.top", "toc.follow", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.9.1/dist/mermaid.min.js"></script>
      
        <script src="../../../assets/javascripts/mermaid-init.js"></script>
      
    
  </body>
</html>