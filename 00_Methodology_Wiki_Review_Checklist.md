# VM 章节审视与交付方法论（复用 04 章经验的通用清单）

> 目标：把每一章交付为“**新人可直接上手理解与排障** + **架构断言可追溯到源码**”的稳定文档集。  
> 使用方式：以本清单做章节验收；若发现缺口，按“入口→Flow→DataStructures→FileNotes→Playbook→完工审查”补齐闭环。

## 1) 章节交付的最小组成（必须齐）

- **单一入口（Stage2 README）**：告诉新人“先看什么、为何看、看完能做什么”，并提供 30min/2h/1d 路线。
- **端到端脊柱图（EndToEnd Flow）**：用一张图把主链路串起来；每个框都能下潜到对应 Flow/DataStructures/FileNotes。
- **Flows（调用链）**：每条 Flow 至少包含：
  - “0) 在端到端主线图中的位置”
  - “证据链（可审计到源码文件/函数/关键条件）”
  - “下一步（新人推荐）”
- **DataStructures（结构卡片）**：每张卡片只写三件事：是什么/不变量/谁写谁读，并回链到 FileNotes。
- **FileNotes（证据链卡片）**：高风险断言必须能定位到源码函数与关键分支（最好含行区间/条件）。
- **新人最小调试手册（MinDebug Playbook）**：能把“症状→第一落点→第二落点”跑通，并给 2–3 个最小可复现实验。
- **完工审查（Completion Review）**：列出 P0 断言清单 + 对应源码证据点 + 仍可优化项。

## 2) 架构师视角：P0 断言必须具备“证据链”

把章节里最容易误导/最容易出事故的结论，全部改成可核验的断言，并绑定证据点：

- **默认值/最终行为差异**：例如“options 默认值 vs 最终选型/降级/强制约束”这种，必须写清楚**触发条件矩阵**。
- **并发/竞态语义**：缓存去重、锁粒度、同一资源的多处写入点，必须写清楚“谁赢/谁回收/谁等待”。
- **平台/构建差异**：宏开关、架构分目录、不同 GC/不同运行模式（debug/release）下的行为差异，必须显式列出。
- **错误与异常语义**：错误码/异常类型/包装策略（例如 CNFE→NCDFE），必须写明“发生点/包装点/对上层含义”。
- **跨章交界**：例如“类加载↔初始化”“解释器↔桥接↔编译器”，必须互链到下一章的入口段落，避免断链。

## 3) 新人视角：学习路径必须“可渐进、可落地”

- **先给心智模型**：一句话解释“本章解决什么问题”，再给脊柱图。
- **再给最短排障闭环**：新人 10–15 分钟能用 Playbook 找到第一落点，并知道下一步看哪里。
- **最后给深入路线**：每条深入点必须能沿着 wiki 一步步下潜，不留“按需/可选深化点”悬空。

## 4) Playbook 的最低可用标准（可复现）

- **快速目录**：常见症状入口（启动失败/找不到类/性能回退/崩溃/异常类型不对…）。
- **决策矩阵**：把“配置/平台/运行模式”对行为的影响列成表（避免口口相传）。
- **可复现日志参数**：给一组能直接复制粘贴的 logger/options（组件/级别/关键开关）。
- **症状→第一落点→第二落点表**：每条至少给 1 个源码锚点 + 1 个文档锚点（Flow/FileNote）。
- **最小实验（2–3 个）**：每个实验写清楚：
  - 目的（验证哪个断言）
  - 操作（命令/参数/输入）
  - 观测点（期望日志/关键函数/关键条件）

## 5) 完工验收（Definition of Done）

- README/Index/EndToEnd 形成“单一路径”，不会让新人在多个入口间迷路。
- 所有 P0 断言都有源码证据点（至少到文件+函数+关键分支条件）。
- Flows 与 DataStructures 都有“0) 位置/下一步”，并能自洽互链。
- Playbook 能闭环 80% 常见问题（至少覆盖本章 Top3 症状）。
- Completion Review 明确：本章范围、P0 断言、证据点、已知限制/待优化项。


